---
layout: post
title: Bearで書いたブログ下書きを効率的にJekyllのソースディレクトリ上に配置する
date: 2018-11-27 13:00
categories: ["Python", "Markdown"]
---

# はじめに
ブログやドキュメントの下書きに[Bear](https://bear.app/)を活用している。アプリはとても満足しているんだけど、下書きをこのブログ構築に使っているJekyllリポジトリに配置するのが手間で悩んでいた。ブログエントリはたいてい画像を含んでいるので、本文をMarkdownで書き出すのに加え画像ファイルもリポジトリ下にコピーしないといけない。

そこで簡単なPythonスクリプトを用意し、一発でリポジトリ下に必要なリソースを配置できるようにした。

# Bear上にあるエントリのデータ構造
Bear上に書いたエントリは `.bearnote` という形式のファイルで管理されている。実体はzipファイルで、展開すると本文のtxtファイルと、文中に含まれる画像がassets下に配置されている。info.json はBearアプリ向けのメタデータで、ここでは触れない。

![Bearエントリのデータ構造](/images/bear-entry-structure.png)

これはBearのエントリリストから任意のエントリをDesktopなどにD&Dすると確認できる。ちなみに画像を含まないエントリの場合はシンプルで、1つのtxtファイルのみでエントリデータが管理されている。

これを利用して、清書して公開したい下書きデータをJekyllリポジトリ下にコピーするスクリプトを作ることにした。

# .bearnoteから素早く記事データを書き出す
スクリプトはJekyllのリポジトリ直下に置いておき、以下のように下書きエントリファイルを指定できるようにした。実行すると.bearnoteから記事本文と画像データを抜き出し、 `_posts` と `_images` 下にそれぞれコピーする。

```sh
$ python3 bear2jekyll.py /path/to/新しいエントリ.bearnote
```


指定したい.bearnoteのパスは、エントリリストからエントリをTerminalにD&Dすれば簡単にわかる。

![](/images/bear2jekyll.gif)

ソースコードはこのように。

<script src="https://gist.github.com/horimislime/2b9febde45dc2249d25b2bf09c6b25af.js"></script>

このままだと本文中の画像はリンクを手直ししないと表示できないんだけど、些細な手間なので手作業でやってる。

# まとめ
Bearで下書きしたエントリを素早くJekyllリポジトリに配置する方法を紹介した。肝はBearが裏側でエントリデータをzip形式で持っているという点で、これが分かっていればアウトプット先はHugoでもなんでもOK。

Bearから下書きをターミナルにD&Dして、少しの手直しでブログが書けるようになって大分捗った。
